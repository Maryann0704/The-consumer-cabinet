<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="1" author="mary">
        <sql>
            CREATE TABLE IF NOT EXISTS `measure_test`.`appuser` (
            `id` INT NOT NULL,
            `name` VARCHAR(45) NOT NULL,
            `email` VARCHAR(45) NOT NULL,
            `password` VARCHAR(45) NOT NULL,
            PRIMARY KEY (`id`))
            ENGINE = InnoDB;
        </sql>
    </changeSet>

    <changeSet id="2" author="mary">
        <sql>
            CREATE TABLE IF NOT EXISTS `measure_test`.`approle` (
            `id` INT NOT NULL,
            `name` VARCHAR(15) NOT NULL,
            PRIMARY KEY (`id`))
            ENGINE = InnoDB;
        </sql>
    </changeSet>

    <changeSet id="3" author="mary">
        <sql>
            CREATE TABLE IF NOT EXISTS `measure_test`.`type` (
            `id` INT NOT NULL,
            `type` VARCHAR(20) NOT NULL,
            PRIMARY KEY (`id`))
            ENGINE = InnoDB;
        </sql>
    </changeSet>

    <changeSet id="4" author="mary">
        <sql>
            CREATE TABLE IF NOT EXISTS `measure_test`.`location` (
            `id` INT NOT NULL,
            `location` VARCHAR(45) NOT NULL,
            PRIMARY KEY (`id`))
            ENGINE = InnoDB;
        </sql>
    </changeSet>

    <changeSet id="5" author="mary">
        <sql>
            CREATE TABLE IF NOT EXISTS `measure_test`.`device` (
            `id` INT NOT NULL,
            `type_id` INT NOT NULL,
            `location_id` INT NOT NULL,
            `appuser_id` INT NOT NULL,
            PRIMARY KEY (`id`),
            INDEX `fk_device_type1_idx` (`type_id` ASC) VISIBLE,
            INDEX `fk_device_location1_idx` (`location_id` ASC) VISIBLE,
            INDEX `fk_device_appuser1_idx` (`appuser_id` ASC) VISIBLE,
            CONSTRAINT `fk_device_type1`
            FOREIGN KEY (`type_id`)
            REFERENCES `measure_test`.`type` (`id`)
            ON DELETE RESTRICT
            ON UPDATE CASCADE,
            CONSTRAINT `fk_device_location1`
            FOREIGN KEY (`location_id`)
            REFERENCES `measure_test`.`location` (`id`)
            ON DELETE RESTRICT
            ON UPDATE CASCADE,
            CONSTRAINT `fk_device_appuser1`
            FOREIGN KEY (`appuser_id`)
            REFERENCES `measure_test`.`appuser` (`id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE)
            ENGINE = InnoDB;
        </sql>
    </changeSet>

    <changeSet id="6" author="mary">
        <sql>
            CREATE TABLE IF NOT EXISTS `measure_test`.`value` (
            `id` INT NOT NULL,
            `value` INT NOT NULL,
            `date` TIMESTAMP(1) NOT NULL,
            `device_id` INT NOT NULL,
            PRIMARY KEY (`id`),
            INDEX `fk_value_device1_idx` (`device_id` ASC) VISIBLE,
            CONSTRAINT `fk_app_value_device1`
            FOREIGN KEY (`device_id`)
            REFERENCES `measure_test`.`device` (`id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE)
            ENGINE = InnoDB;
        </sql>
    </changeSet>

    <changeSet id="7" author="mary">
        <sql>
            CREATE TABLE IF NOT EXISTS `measure_test`.`appuser_approle` (
            `appuser_id` INT NOT NULL,
            `approle_id` INT NOT NULL,
            PRIMARY KEY (`appuser_id`, `approle_id`),
            INDEX `fk_appuser_approle_approle1_idx` (`approle_id` ASC) VISIBLE,
            INDEX `fk_appuser_approle_appuser1_idx` (`appuser_id` ASC) VISIBLE,
            CONSTRAINT `fk_appuser_approle_appuser1`
            FOREIGN KEY (`appuser_id`)
            REFERENCES `measure_test`.`appuser` (`id`)
            ON DELETE RESTRICT
            ON UPDATE CASCADE,
            CONSTRAINT `fk_appuser_approle_approle1`
            FOREIGN KEY (`approle_id`)
            REFERENCES `measure_test`.`approle` (`id`)
            ON DELETE RESTRICT
            ON UPDATE CASCADE)
            ENGINE = InnoDB;
        </sql>
    </changeSet>

    <changeSet id="8" author="mary">
        <sql>
            INSERT INTO `measure_test`.`appuser` (`id`, `name`, `email`, `password`) VALUES (1, 'Andrey Scorokhodov', 'andScor@tut.by', '10293qwerty84756');
        </sql>
    </changeSet>

    <changeSet id="9" author="mary">
        <sql>
            INSERT INTO `measure_test`.`approle` (`id`, `name`) VALUES (1, 'administrator');
        </sql>
    </changeSet>

    <changeSet id="10" author="mary">
        <sql>
            INSERT INTO `measure_test`.`approle` (`id`, `name`) VALUES (2, 'user');
        </sql>
    </changeSet>

    <changeSet id="11" author="mary">
        <sql>
            INSERT INTO `measure_test`.`type` (`id`, `type`) VALUES (1, 'electric meter');
        </sql>
    </changeSet>

    <changeSet id="12" author="mary">
        <sql>
            INSERT INTO `measure_test`.`type` (`id`, `type`) VALUES (2, 'hot water meter');
        </sql>
    </changeSet>

    <changeSet id="13" author="mary">
        <sql>
            INSERT INTO `measure_test`.`type` (`id`, `type`) VALUES (3, 'cold water meter');
        </sql>
    </changeSet>

    <changeSet id="14" author="mary">
        <sql>
            INSERT INTO `measure_test`.`type` (`id`, `type`) VALUES (4, 'warm meter');
        </sql>
    </changeSet>

    <changeSet id="15" author="mary">
        <sql>
            INSERT INTO `measure_test`.`location` (`id`, `location`) VALUES (1, 'bathroom');
        </sql>
    </changeSet>

    <changeSet id="16" author="mary">
        <sql>
            INSERT INTO `measure_test`.`location` (`id`, `location`) VALUES (2, 'water closet');
        </sql>
    </changeSet>

    <changeSet id="17" author="mary">
        <sql>
            INSERT INTO `measure_test`.`location` (`id`, `location`) VALUES (3, 'kitchen');
        </sql>
    </changeSet>

    <changeSet id="18" author="mary">
        <sql>
            INSERT INTO `measure_test`.`location` (`id`, `location`) VALUES (4, 'room');
        </sql>
    </changeSet>

    <changeSet id="19" author="mary">
        <sql>
            INSERT INTO `measure_test`.`appuser_approle`(`appuser_id`, `approle_id`) VALUES (1, 1);
        </sql>
    </changeSet>

</databaseChangeLog>